# webサーバのように複数の相手と通信するようなものを作りたい

forkを使った方法を紹介する

# forkシステムコール

プログラムの中で自分自身を起動するわけではない

プロセスを複製する

# 実行時引数の上手いとり方があるらしい？

# 子プロセスの生成

fork()を呼び出すと子を作る

その後、親か子は返り値で判断できる

(child=fork()) == 0 なら子プロセスである



子プロセスでは、新しい通信を受け付けないので、

```c
close(sock_listen);
```

しておく。通信が終われば、

```c
close(sock_accepted);

exit(EXIT_SUCCSES);
```

する。



親は、fork()の返り値が正の値になる。

プロセスをいくつつくったか分かるように、nprosessを用意している。



fork()の返り値が負の場合はエラー



# ゾンビプロセスの回収

親プロセスの側から子プロセスが正常に処理を終えたかどうか情報を得るために、生き残った状態

処理はしていないのに、メモリに残った状態になっている

これをゾンビプロセス、と呼ぶ



適度に処理しないと、メモリを食いつぶしてしまう。



wait()や、waitpid()を使って、回収する

wait()は、回収できるゾンビプロセスがなかったら、そこで処理を止めてしまう

ので、waitpid()で、WNOHANGオプションを指定すれば、回収できるだけ回収する



# コマンドラインオプションの解析

デフォルト値があったり、オプション指定をすることができたり。



## getopt

自分で用意してもいいけど、getopt関数が用意されているので、

これを利用すると楽。



