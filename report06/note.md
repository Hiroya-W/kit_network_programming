
# 第6回

タイプ: ノート
作成日: Jun 8, 2020 1:03 PM
復習済み: No
講義名: ネットワークプログラミング

# forkとthreadの違い

見かけ的な複数の処理を実現できた

プロセスのコピーを行うので、負荷のかかる処理になってしまう

並列的な処理を行うときは、threadを用いることが多い。

## thread

プロセスとしては1つであるが、プロセスの中で複数処理を行う

プロセスをコピーしないので、比較的軽い

大域変数などは共有するので、注意する必要がある

# スレッドでtch_echo

threadライブラリを使う

通信はスレッドの中身で行われる

forの無限ループは、クライアントとの通信を待ち続けているだけ

# スレッドの作成

void型のポインタを1つだけ受け取れるという制約がある

複数の引数を渡すのは少し、工夫が必要になる

詳しくは、構造体を用意して、その中に、データを詰め込んでいる

## メモリの開放

スレッドの中だけで使う変数は、メイン関数と同じものを使用しているか、注意しないといけない

sockの値が書き変わるが、それが各スレッドへも影響が及んでしまう

なので、スレッド内で変数をコピーして利用して、メイン関数の方では、確保したメモリ領域を解放しておく

# スレッドの終了

子スレッドが動いている状態で主スレッドが終了すると、子スレッドも一緒に終了する

forkは別プロセスを作成するので、関係ないが。

ソケットは、プロセス単位で管理されている

まぁ、sockをクローズするタイミングがややこしいらしい。

# 課題

一回作ったのに、すぐ消すのはつらい

重い処理なので。

だから、あらかじめ決まった数の子プロセスを生成するようにしておく。

# 小テスト

3回ループのやつを複製する
